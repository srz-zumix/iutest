# optional cmake test steps template

parameters:
  container_image: 'gcc:latest'
  cmake_options: ''
  ctest_options: ''

resources:
  containers:
  - container: builder
    image: ${{ parameters.container_image }}
steps:
- task: Docker@2
  displayName: Login to Docker Hub
  inputs:
    command: login
    containerRegistry: DockerHub

# cmake steps
- script: |
    mkdir build && cd build
    cmake ../projects/cmake ${{ parameters.cmake_options }}
  target:
    container: builder
  displayName: 'generate'

- script: |
    cd build && cmake --build .
  target:
    container: builder
  displayName: 'build'

- script: |
    cd build && ctest ${{ parameters.ctest_options }} -V --output-on-failure
  target:
    container: builder
  displayName: 'test'

- task: Docker@2
  inputs:
    command: stop
    container: builder
- task: Docker@2
  displayName: Logout of Docker Hub
  inputs:
    command: logout
    containerRegistry: DockerHub
